import{x as p,Q as S,o as n,g as i,h as o,l as s,k as e,t as r,w as f,cs as I,ct as M,J as z,W as q,X as O,L as J,A as Q,a4 as X,E as F,ad as H,ae as K,af as Y}from"../assets/post-2433f428.js";import{u as Z,g as x,c as aa,s as A}from"../assets/formvibes-4c4994e4.js";import{b as ea,d as ta,c as la}from"../assets/select-b70937af.js";import{C as sa,p as oa,a as na,b as ra,B as da,c as ca,L as ua,P as ia,d as va,f as ma}from"../assets/index-4baa6a2e.js";import{E as fa,a as _a}from"../assets/collapse-item-ac72ec57.js";import{_ as pa}from"../assets/date-picker-25a0adc5.js";import"../assets/focus-trap-9b255300.js";import"../assets/index-fb3a1e53.js";import"../assets/date-picker-1de719c3.js";import"../assets/index-8e3cc18a.js";const ha={class:"fv-chart"},ba={__name:"chart",props:["chartData","chartType","chartOptions"],setup(a){sa.register(oa,na,ra,da,ca,ua,ia,va);const e=a,l=p({labels:[],datasets:[{label:"",data:[]}]});return S([()=>e.chartData],(()=>{l.value={labels:e.chartData.labels,datasets:e.chartData.datasets}})),(e,t)=>(n(),i("div",ha,[o(s(ma),{data:l.value,height:"100%",width:"100%",options:a.chartOptions},null,8,["data","options"])]))}},ga={class:"fv-stats"},ya={class:"fv-count fv-stats-col"},Da={className:"fv-text-xl"},wa={key:0},ka={key:1},Ca={key:0,class:"fv-cmpr fv-stats-col"},Ea={key:1,class:"fv-cmpr fv-stats-col"},Pa={key:0},$a={key:1},Sa={__name:"stats",props:["dashboardData","date","preset"],setup(a){const l=a,t=p(0);return S([()=>l.dashboardData],(()=>{let a=Number(l.dashboardData?.previousDateRangeDataCount),e=Number(l.dashboardData?.totalEntries);a<=0||(t.value=Math.ceil((e-a)/a*100))})),(l,u)=>{const d=z;return n(),i("div",ga,[e("div",ya,[e("span",Da,r(a.dashboardData?.totalEntries),1),"Custom"!==a.preset?(n(),i("div",wa,r(a.preset.replaceAll("_"," ")),1)):(n(),i("div",ka,r(a.date[0])+" - "+r(a.date[1]),1))]),0===Number(a.dashboardData?.previousDateRangeDataCount)?(n(),i("div",Ca," No Data to Compare! ")):(n(),i("div",Ea,[a.dashboardData?.totalEntries>=Number(a.dashboardData?.previousDateRangeDataCount)?(n(),i("div",Pa,[o(d,null,{default:f((()=>[o(s(I))])),_:1}),e("span",null,r(t.value)+"%",1)])):(n(),i("div",$a,[o(d,null,{default:f((()=>[o(s(M))])),_:1}),e("span",null,r(t.value)+"%",1)]))]))])}}},Va={class:"fv-dbw-form-list"},La={class:"fv-dbw-form-list-count"},Na={__name:"entry-count",props:["dashboardData","date"],setup(a){const s=p(!1),l=a=>{s.value=!s.value};return(s,t)=>{const u=fa,d=_a;return n(),i("div",null,[o(d,{modelValue:s.activeNames,"onUpdate:modelValue":t[0]||(t[0]=a=>s.activeNames=a),onChange:l},{default:f((()=>[o(u,{title:`Total Entries By Forms (${a.date[0]} to ${a.date[1]}) `},{default:f((()=>[(n(!0),i(q,null,O(a.dashboardData?.allFormsDataCount,((a,s)=>(n(),i("div",{key:s,class:"fv-dbw-form-list-item"},[e("span",Va,r(a.formName)+" ("+r(a.plugin)+") ",1),e("span",La,r(a.count),1)])))),128))])),_:1},8,["title"])])),_:1},8,["modelValue"])])}}},Fa={className:"fv-hidden",id:"fv-dashboard-settings"},qa={class:"fv-row fv-form-row"},Oa={class:"fv-form-row-label"},Ba={class:"fv-row fv-form-row"},xa={class:"fv-row fv-form-row"},Aa={__name:"dashboard",setup(a){const l=Z(),{formsSelector:t,isLoading:u,generalStates:d,currentForm:v,currentPlugin:c,notice:m,dates:b,preset:h}=J(l),y=t.value,_=window.fvGlobalVar?.i18n,D=p(x("fv-form")),g=p(x("fv-analytics-filter")||"month"),k=p([]),w=p({scales:{y:{min:0,ticks:{stepSize:1}}}});p("bar");const C=p([]),P=p([]);Q((()=>{if(!D.value){const a=y[0]?.label,e=y[0]?.options[0]?.value;D.value=e,d.value.queryParams={...d.value.queryParams,plugin:a,formid:e}}j()})),S([D,()=>d.value.queryParams],(()=>{j()}));const j=async()=>{u.value=!0;let{queryParams:a}=d.value;a={...a,fromDate:b.value[0]||"",toDate:b.value[1]||""};try{const{data:e}=await X({queryParams:{...a,dashboard_data:!0,allForms:y},action:"fv_get_analytics_data"}),{dashboard_data:s,...t}=e;P.value=s,N(t),l.resetError()}catch(a){m.value={...m.value,isError:!0,message:a.message}}finally{u.value=!1}};S([g],(()=>{A("fv-analytics-filter",g.value),d.value={...d.value,queryParams:{...d.value.queryParams,filter_type:g.value}},j()}));const N=a=>{const e=[];e.labels=[],e.datasets=[],e.data=[],Object.keys(a).forEach((s=>{e.labels.push(a[s].Label),e.data.push(a[s].count)}));const s={labels:e.labels,datasets:[{label:"Leads",backgroundColor:"#0071a14D",borderColor:"#0071a1",borderWidth:3,hoverBackgroundColor:"#00aadc",data:e.data}]};Object.keys(s).length>0&&(k.value=s),C.value=e.data.every((a=>0===a)),u.value=!1};return(a,l)=>{const t=ea,u=ta,p=la,m=H;return n(),F(m,null,{default:f((()=>[e("div",Fa,[e("div",qa,[e("span",Oa,r(s(_)?.form),1),o(p,{modelValue:D.value,"onUpdate:modelValue":l[0]||(l[0]=a=>D.value=a),placeholder:"Select Form",class:"fv-dsw-forms"},{default:f((()=>[(n(!0),i(q,null,O(s(y),(a=>(n(),F(u,{key:a.label,label:a.label},{default:f((()=>[(n(!0),i(q,null,O(a.options,(e=>(n(),F(t,{key:e.value,label:e.label,value:e.value,onClick:s=>((a,e)=>{const s=y.filter((a=>a.label===e.label))[0].options.filter((e=>e.value===a))[0];aa(!0),A("fv-form",s);const l=s.plugin,t=s.value;c.value=l,v.value=t,d.value={...d.value,queryParams:{...d.value.queryParams,plugin:l||(y?.length>0?y[0]?.options[0]?.plugin:[]),formid:t||(y?.length>0?y[0]?.options[0]?.value:[])}}})(e.value,a)},null,8,["label","value","onClick"])))),128))])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])]),e("div",Ba,[e("span",null,r(s(_)?.date_range),1),o(pa)]),e("div",xa,[e("span",null,r(s(_)?.filter),1),o(p,{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=a=>g.value=a),placeholder:"Select",class:"fv-dsw-filter"},{default:f((()=>[o(t,{label:s(_).by_day,value:"day"},{default:f((()=>[e("span",null,r(s(_)?.by_day),1)])),_:1},8,["label"]),o(t,{label:s(_).by_week,value:"week"},{default:f((()=>[e("span",null,r(s(_).by_week),1)])),_:1},8,["label"]),o(t,{label:s(_).by_month,value:"month"},{default:f((()=>[e("span",null,r(s(_).by_month),1)])),_:1},8,["label"])])),_:1},8,["modelValue"])])]),e("div",null,[o(ba,{chartData:k.value,chartOptions:w.value},null,8,["chartData","chartOptions"])]),e("div",null,[o(Sa,{dashboardData:P.value,date:s(b),preset:s(h)},null,8,["dashboardData","date","preset"])]),e("div",null,[o(Na,{dashboardData:P.value,date:s(b)},null,8,["dashboardData","date"])])])),_:1})}}},Ra=K(),R=Y(Aa);R.use(Ra),R.mount("#fv-dashboard-widgets-0");