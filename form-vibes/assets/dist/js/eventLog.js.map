{"version":3,"file":"eventLog.js","sources":["../../../src/Components/EventLog/log-expand-data.vue","../../../src/Components/EventLog/event-log.vue","../../../src/eventLog.js"],"sourcesContent":["<script setup>\nimport { ref } from 'vue';\nimport { storeToRefs } from \"pinia\";\nimport VueResizable from 'vue-resizable'\nimport { CloseBold } from '@element-plus/icons-vue';\nimport { setToLocalStorage } from '../../stores/utils';\nimport { useFVStore } from '../../stores/formvibes';\n\nconst store = useFVStore();\nconst props = defineProps(['row','closeExpand']);\nconst handlers = ref([ 'lb', 'l', 'lt']);\n\nconst { generalStates, size } = storeToRefs(store);\nconst resizeStop = (e) => {\n    const width = e.width;\n    const height = e.height;\n    if (Number(width) <= 400) {\n        setToLocalStorage('fv-sidebar', {\n            width: 400,\n            height: width,\n        });\n    }\n    else{\n        setToLocalStorage('fv-sidebar', {\n            width: width,\n            height: height,\n        });\n    }\n\n    generalStates.value.size = {\n        width: width,\n        height: height\n    }\n};\n\n</script>\n<template>\n    <vue-resizable class=\"fv-side-panel\" :width=\"size.width\" :active=\"handlers\" height=\"100%\" style=\"position: fixed;left: unset;right: 0;z-index: 99999;cursor: unset;\" @resize:end=\"resizeStop\">\n        <div class=\"resizable-content\" >\n            <div class=\"fv-expand-content-wrapper\">\n                <el-icon class=\"fv-cursor\" size=\"20\" @click=\"closeExpand\"><CloseBold /></el-icon>\n                <div class=\"fv-expand-content\">\n                    <dl>\n                        <div class=\"fv-expand-row\" v-for=\"(dt,key,index) in row\" :key=\"index\">\n                            <dt>\n                                {{key}}\n                            </dt>\n                            <dd>\n                                <span>{{dt}}</span>\n                            </dd>\n                        </div>\n                    </dl>\n                </div>\n            </div>\n        </div>\n    </vue-resizable> \n</template>","<script setup>\nimport { watch, ref, onMounted } from 'vue';\nimport FvHeader from '../shared/header.vue';\nimport { axiosPost } from '../../Axios/post';\nimport LogExpandData from './log-expand-data.vue';\nimport { useFVStore } from '../../stores/formvibes';\nimport { storeToRefs } from 'pinia';\n\nconst store = useFVStore();\nconst { pageSizes } = storeToRefs(store);\nconst isLoading = ref(false);\nconst perPage = ref(10);\nconst currentPage = ref(1);\nconst tableData = ref([]);\nconst logCount = ref(0);\nconst selectedRow = ref('');\nconst isExpanded = ref(false);\n\nconst handleSizeChange = (val) => {\n    perPage.value = parseInt(val);\n}\nconst i18n = window.fvGlobalVar?.i18n;\n\nconst handleCurrentChange = (val) => {\n    currentPage.value = parseInt(val);\n}\n\nwatch([perPage, currentPage], () => {\n    getEventLogData();\n})\nonMounted(() => {\n    getEventLogData();\n});\nconst isJsonString = (str) => {\n\ttry {\n\t\tconst json = JSON.parse(str);\n\t\treturn typeof json === 'object';\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\nconst getEventLogData = async () => {\n    isLoading.value = true;\n    const {\n\t\t\tdata: { count, data: eventLogsData },\n\t\t} = await getData();\n        logCount.value = parseInt(count);\n    const data = eventLogsData.map((d) => {\n            let { description, event } = d;\n            if (isJsonString(d.description) && event === 'edit-data') {\n                const parsedDescription = JSON.parse(d.description);\n                description = `Entry ID: ${parsedDescription.entry_id},${i18n?.field_name}: ${parsedDescription.field_name}\n                ${parsedDescription.value.prev_value} => ${parsedDescription.value.next_value}`;\n            }\n            return {\n                ...d,\n                description,\n                event,\n            };\n        });\n    tableData.value = data;\n\n    isLoading.value = false;\n}\n\nconst getData = async () => {\n    const page = currentPage.value;\n    const pageSize = perPage.value;\n\n    const res = await axiosPost({\n\t\taction: 'fv_event_logs',\n\t\tqueryParams: {\n\t\t\tpage,\n\t\t\tpageSize,\n\t\t},\n\t});\n\n    return res;\n}\nconst rowClick = (row) => {\n    selectedRow.value = row;\n}\nconst closeExpand = () => {\n    selectedRow.value = '';\n}\nwatch(selectedRow,()=> {\n    if(selectedRow.value){\n        isExpanded.value = true;\n    }\n    else{\n        isExpanded.value = false;\n    }\n})\n</script>\n<template>\n    <el-config-provider>\n        <div>\n            <FvHeader />\n            <div class=\"fv-content-wrapper\">\n                <div class=\"fv-page-title\">\n                    <h3>Event Log</h3>\n                </div>\n                <div class=\"fv-event-log-wrapper\">\n                    <el-table :data=\"tableData\" @row-click=\"rowClick\" v-loading=\"isLoading\">\n                        <el-table-column prop=\"serial_number\" label=\"S/N\" width=\"80\" />\n                        <el-table-column prop=\"user\" label=\"User\" width=\"180\" />\n                        <el-table-column prop=\"event\" label=\"Event\" width=\"180\" />\n                        <el-table-column prop=\"description\" label=\"Description\" />\n                        <el-table-column prop=\"export_time_gmt\" label=\"Time\" width=\"200\" />\n                    </el-table>\n                    <div class=\"fv-table-pagination\">\n                        <el-pagination\n                            class=\"fv-pagination\"\n                            layout=\"total, sizes, prev, pager, next\" \n                            :total=\"logCount\"\n                            :current-page=\"currentPage\"\n                            :page-sizes=\"pageSizes\" \n                            :page-size=\"perPage\"\n                            @size-change=\"handleSizeChange\"\n                            @current-change=\"handleCurrentChange\"\n                            background\n                        />\n                    </div>\n                </div>\n            </div>\n            <LogExpandData :row=\"selectedRow\" :closeExpand=\"closeExpand\" v-if=\"isExpanded\" />\n        </div>\n    </el-config-provider>\n</template>","import { createApp } from 'vue'\nimport EventLog from './Components/EventLog/event-log.vue';\nimport { createPinia } from \"pinia\";\n// import '../node_modules/element-plus/theme-chalk/src/notification.scss';\nimport './Assets/eventLog.scss';\nimport 'element-plus/dist/index.css';\n// import './assets/global.css';\n//import './Assets/main.scss';\n\n\nconst pinia = createPinia();\nconst eventLogApp = createApp(EventLog);\neventLogApp.use(pinia);\n\n\neventLogApp.mount('#fv-event-log-wrapper')\n"],"names":["store","useFVStore","handlers","ref","generalStates","size","storeToRefs","resizeStop","e","width","height","setToLocalStorage","pageSizes","isLoading","perPage","currentPage","tableData","logCount","selectedRow","isExpanded","handleSizeChange","val","i18n","handleCurrentChange","watch","getEventLogData","onMounted","isJsonString","str","count","eventLogsData","getData","data","description","event","parsedDescription","page","pageSize","axiosPost","rowClick","row","closeExpand","pinia","createPinia","eventLogApp","createApp","EventLog"],"mappings":"izBAQA,MAAAA,EAAAC,EAAA,EAEAC,EAAAC,EAAA,CAAA,KAAA,IAAA,IAAA,CAAA,EAEA,CAAA,cAAAC,EAAA,KAAAC,CAAA,EAAAC,EAAAN,CAAA,EACAO,EAAAC,GAAA,CACA,MAAAC,EAAAD,EAAA,MACAE,EAAAF,EAAA,OACA,OAAAC,CAAA,GAAA,IACAE,EAAA,aAAA,CACA,MAAA,IACA,OAAAF,CACA,CAAA,EAGAE,EAAA,aAAA,CACA,MAAAF,EACA,OAAAC,CACA,CAAA,EAGAN,EAAA,MAAA,KAAA,CACA,MAAAK,EACA,OAAAC,CACA,CACA,yvBCzBA,MAAAV,EAAAC,EAAA,EACA,CAAA,UAAAW,CAAA,EAAAN,EAAAN,CAAA,EACAa,EAAAV,EAAA,EAAA,EACAW,EAAAX,EAAA,EAAA,EACAY,EAAAZ,EAAA,CAAA,EACAa,EAAAb,EAAA,CAAA,CAAA,EACAc,EAAAd,EAAA,CAAA,EACAe,EAAAf,EAAA,EAAA,EACAgB,EAAAhB,EAAA,EAAA,EAEAiB,EAAAC,GAAA,CACAP,EAAA,MAAA,SAAAO,CAAA,CACA,EACAC,EAAA,OAAA,aAAA,KAEAC,EAAAF,GAAA,CACAN,EAAA,MAAA,SAAAM,CAAA,CACA,EAEAG,EAAA,CAAAV,EAAAC,CAAA,EAAA,IAAA,CACAU,GACA,CAAA,EACAC,EAAA,IAAA,CACAD,GACA,CAAA,EACA,MAAAE,EAAAC,GAAA,CACA,GAAA,CAEA,OAAA,OADA,KAAA,MAAAA,CAAA,GACA,QACA,MAAA,CACA,MAAA,EACA,CACA,EACAH,EAAA,SAAA,CACAZ,EAAA,MAAA,GACA,KAAA,CACA,KAAA,CAAA,MAAAgB,EAAA,KAAAC,CAAA,CACA,EAAA,MAAAC,EAAA,EACAd,EAAA,MAAA,SAAAY,CAAA,EACA,MAAAG,EAAAF,EAAA,IAAA,GAAA,CACA,GAAA,CAAA,YAAAG,EAAA,MAAAC,CAAA,EAAA,EACA,GAAAP,EAAA,EAAA,WAAA,GAAAO,IAAA,YAAA,CACA,MAAAC,EAAA,KAAA,MAAA,EAAA,WAAA,EACAF,EAAA,aAAAE,EAAA,QAAA,IAAAb,GAAA,UAAA,KAAAa,EAAA,UAAA;AAAA,kBACAA,EAAA,MAAA,UAAA,OAAAA,EAAA,MAAA,UAAA,EACA,CACA,MAAA,CACA,GAAA,EACA,YAAAF,EACA,MAAAC,CACA,CACA,CAAA,EACAlB,EAAA,MAAAgB,EAEAnB,EAAA,MAAA,EACA,EAEAkB,EAAA,SAAA,CACA,MAAAK,EAAArB,EAAA,MACAsB,EAAAvB,EAAA,MAUA,OARA,MAAAwB,EAAA,CACA,OAAA,gBACA,YAAA,CACA,KAAAF,EACA,SAAAC,CACA,CACA,CAAA,CAGA,EACAE,EAAAC,GAAA,CACAtB,EAAA,MAAAsB,CACA,EACAC,EAAA,IAAA,CACAvB,EAAA,MAAA,EACA,EACA,OAAAM,EAAAN,EAAA,IAAA,CACAA,EAAA,MACAC,EAAA,MAAA,GAGAA,EAAA,MAAA,EAEA,CAAA,yyBClFA,MAAMuB,GAAQC,EAAW,EACnBC,EAAcC,EAAUC,EAAQ,EACtCF,EAAY,IAAIF,EAAK,EAGrBE,EAAY,MAAM,uBAAuB"}