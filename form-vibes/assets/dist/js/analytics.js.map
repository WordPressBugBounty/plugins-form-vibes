{"version":3,"file":"analytics.js","sources":["../../../src/Components/Analytics/analtics-control-bar.vue","../../../src/Components/Analytics/chart.vue","../../../src/Components/Analytics/analytics.vue","../../../src/analytics.js"],"sourcesContent":["<script setup>\nimport { watch, ref, onMounted } from 'vue';\nimport { storeToRefs } from \"pinia\";\nimport datePicker from '../shared/date-picker.vue';\nimport { useFVStore } from '../../stores/formvibes';\nimport { getFromLocalStorage, setToLocalStorage } from '../../stores/utils';\nimport { PieChart, Refresh, TrendCharts, Histogram } from '@element-plus/icons-vue';\n\nconst store = useFVStore();\nconst selectedChart = ref('bar');\nconst props = defineProps(['getAnalyticsData', 'chartType', 'changeChartType']);\nconst { formsSelector, generalStates, isNoPlugins, isPro, dates } = storeToRefs(store);\n\nconst forms = formsSelector.value;\nconst selectedForm = ref(getFromLocalStorage('fv-form'));\nconst selectedFilter = ref(getFromLocalStorage('fv-analytics-filter') || 'month');\n\nonMounted(() => {\n    if(!selectedForm.value){\n        const firstplugin = forms[0]?.label;\n        const firstform = forms[0]?.options[0]?.value;\n        selectedForm.value = firstform;\n        generalStates.value.queryParams = {\n            ...generalStates.value.queryParams,\n            plugin: firstplugin,\n            formid: firstform,\n        }\n    }\n});\nwatch([selectedChart], () => {\n    props.changeChartType(selectedChart);\n    setToLocalStorage('fv-chart-type', selectedChart);\n});\n\n// watch([dates], () => {\n//     props.getAnalyticsData();\n// })\n\nwatch([selectedFilter], () => {\n    setToLocalStorage('fv-analytics-filter', selectedFilter.value);\n    generalStates.value = {\n        ...generalStates.value,\n        queryParams: {\n            ...generalStates.value.queryParams,\n            filter_type: selectedFilter.value\n        }\n    }\n\n    props.getAnalyticsData();\n})\n\nconst onChangeForm = (id, e) => {\n    const form = forms.filter((form) => form.label === e.label)[0].options.filter((fm) => fm.value === id)[0];\n    const plugin = form.plugin;\n    const formid = form.value;\n    setToLocalStorage('fv-form', form);\n    generalStates.value = {\n        ...generalStates.value,\n        queryParams: {\n            ...generalStates.value.queryParams,\n            plugin:\n                plugin || (forms?.length > 0 ? forms[0]?.options[0]?.plugin : []),\n            formid:\n                formid || (forms?.length > 0 ? forms[0]?.options[0]?.value : []),        \n        }\n    }\n\n    props.getAnalyticsData();\n}\n\n</script>\n<template>\n    <div class=\"fv-content-wrapper fv-action-bar-wrapper\">\n        <div class=\"fv-page-title\">\n            <h3>Analytics</h3>\n        </div>\n        <div class=\"fv-action-bar\">\n            <div class=\"fv-analytics-controls left\">\n                <datePicker />\n                <!-- Form Drop Down -->\n                <el-select v-model=\"selectedForm\" placeholder=\"Select\">\n                    <el-option-group\n                        v-for=\"group in forms\"\n                        :key=\"group.label\"\n                        :label=\"group.label\"\n                        >\n                        <el-option\n                            v-for=\"item in group.options\"\n                            :key=\"item.value\"\n                            :label=\"item.label\"\n                            :value=\"item.value\"\n                            @click=\"(e) => onChangeForm(item.value,group)\"\n                        />\n                    </el-option-group>\n                </el-select>\n            </div>\n            <div class=\"fv-analytics-controls right\">\n                \n                <el-icon size=\"20\" @click=\"selectedChart = 'bar'\" :class=\"{'active' : selectedChart == 'bar' }\" class=\"fv-anyltics-chart\"><Histogram /></el-icon>\n                <el-icon size=\"20\" @click=\"selectedChart = 'line'\" :class=\"{'active' : selectedChart == 'line' }\" class=\"fv-anyltics-chart\"><TrendCharts /></el-icon>\n                <el-icon size=\"20\" @click=\"getAnalyticsData()\"><Refresh /></el-icon>\n                <el-select v-model=\"selectedFilter\" placeholder=\"Select\">\n                    <el-option label=\"By Day\" value=\"day\">\n                        <!-- <el-icon ></el-icon> -->\n                        <span>By Day</span>\n                    </el-option>\n                    <el-option label=\"By Week\" value=\"week\">\n                        <!-- <el-icon ></el-icon> -->\n                        <span>By Week</span>\n                    </el-option>\n                    <el-option label=\"By Month\" value=\"month\">\n                        <!-- <el-icon ></el-icon> -->\n                        <span>By Month</span>\n                    </el-option>\n            </el-select>\n            </div>\n        </div>\n    </div>\n</template>","<script setup>\nimport { watch, ref } from 'vue';\nimport { storeToRefs } from \"pinia\";\nimport { Bar, Line } from 'vue-chartjs';\nimport { Chart as ChartJS, Title, Tooltip, Legend, BarElement, CategoryScale, LinearScale, PointElement, LineElement } from 'chart.js';\n\nChartJS.register(Title, Tooltip, Legend, BarElement, CategoryScale, LinearScale, PointElement, LineElement);\n\nconst props = defineProps(['chartData', 'chartOption', 'chartType', 'isLoading']);\nconst chartDatas = ref({\n  labels: [],\n  datasets: [\n    {\n      label: '',\n      data: []\n    }\n  ]\n});\n\nconst chartOptions = ref({\n  responsive: true,\n  maintainAspectRatio: false\n})\n\nwatch([() => props.chartData], () => {\n    chartDatas.value = {\n        labels: props.chartData.labels,\n        datasets: props.chartData.datasets\n    }\n})\n\n</script>\n<template>\n    <div class=\"fv-content-wrapper\">\n      <div class=\"fv-chart-wrapper\" v-loading=\"isLoading\">\n        <Bar :data=\"chartDatas\" v-if=\"chartType == 'bar'\" height=\"100\" :options = \"chartOption\"/>\n        <Line :data=\"chartDatas\" v-if=\"chartType == 'line'\" height=\"100\" :options = \"chartOption\"/>\n      </div>\n    </div>\n</template>","<script setup>\nimport { onMounted, ref, watch } from 'vue';\nimport { useFVStore} from \"@/stores/formvibes\";\nimport Header from '../shared/header.vue';\nimport AnalyticsControl from './analtics-control-bar.vue';\nimport Chart from './chart.vue';\nimport { setToLocalStorage } from '../../stores/utils';\nimport { storeToRefs } from 'pinia';\nimport { axiosPost } from '../../Axios/post';\nconst store = useFVStore();\n\nconst {isNoPlugins, isLoading, generalStates, dates, notice} = storeToRefs(store);\nconst chartData = ref([]);\nconst chartType = ref('bar');\nconst noData = ref([]);\n\nconst chartOption = ref({\n    scales: {\n        y: {\n            min: 0, // Ensures the y-axis starts at 0\n            ticks: {\n                stepSize: 1,\n            },\n        }\n    }\n});\n\nonMounted( () => {\n  getAnalyticsData();\n});\n\nwatch([() => generalStates.value.queryParams], () => {\n  getAnalyticsData();\n});\n\nconst prepareChatData = (data) => {\n\tconst attributes = [];\n\tattributes.labels = [];\n\tattributes.datasets = [];\n\tattributes.data = [];\n\n\tObject.keys(data).forEach((row) => {\n\t\tattributes.labels.push(data[row].Label);\n\t\tattributes.data.push(data[row].count);\n\t});\n\n\tconst cData = {\n\t\tlabels: attributes.labels,\n\t\tdatasets: [\n\t\t\t{\n\t\t\t\tlabel: 'Leads',\n\t\t\t\tbackgroundColor: '#0071a14D',\n\t\t\t\tborderColor: '#0071a1',\n\t\t\t\tborderWidth: 3,\n\t\t\t\thoverBackgroundColor: '#00aadc',\n\t\t\t\tdata: attributes.data,\n\t\t\t},\n\t\t],\n\t};\n\n\tif (Object.keys(cData).length > 0) {\n\t\tchartData.value = cData;\n\t}\n\tnoData.value = attributes.data.every((d) => d === 0);\n};\n\nconst getAnalyticsData = async () => {\n\tif (isNoPlugins.value) return;\n\tisLoading.value = true;\n    let {queryParams} = generalStates.value;\n\n\t\n    queryParams = {\n      ...queryParams,\n      fromDate: dates.value[0] || '',\n      toDate: dates.value[1] || '',\n    }\n\ttry {\n\t\tconst { data } = await axiosPost({\n\t\t\tqueryParams,\n\t\t\taction: 'fv_get_analytics_data',\n\t\t});\n\n\t\tprepareChatData(data);\n\t\tstore.resetError();\n\t} catch (error) {\n\t\t\tnotice.value = {\n\t\t\t...notice.value,\n\t\t\tisError: true,\n\t\t\tmessage: error.message,\n\t\t}\n\t}\n\tfinally {\n\t\tisLoading.value = false;\n\t}\n};\n\nconst changeChartType = (value) => {\n  chartType.value = value._value;\n}\n\nwatch([notice], () => {\n\tif(notice.value.message === '') return;\n    ElNotification({\n        offset: 30,\n        dangerouslyUseHTMLString: true,\n        message: `<strong>${notice.value.message}</strong>`,\n        type: notice.value.isError ? 'error' : 'success',\n        class:'fv-items-center'\n    })\n})\n</script>\n\n<template>\n    <el-config-provider>\n      <div>\n        <Header />\n        <AnalyticsControl :getAnalyticsData=\"getAnalyticsData\" :chartType=\"chartType\" :changeChartType=\"changeChartType\" />\n        <Chart :chartData=\"chartData\" :chartOption=\"chartOption\" :chartType=\"chartType\" :isLoading=\"isLoading\" />\n      </div>\n  </el-config-provider>\n</template>","import { createApp } from 'vue'\nimport Analytics from '../src/Components/Analytics/analytics.vue'\nimport { createPinia } from \"pinia\";\nimport './assets/analytics.scss';\nimport 'element-plus/dist/index.css';\n// import './assets/main.scss';\n\n\nconst pinia = createPinia();\nconst analyticsApp = createApp(Analytics);\nanalyticsApp.use(pinia);\n\n\nanalyticsApp.mount('#fv-analytics')\n"],"names":["store","useFVStore","selectedChart","ref","props","__props","formsSelector","generalStates","isNoPlugins","isPro","dates","storeToRefs","forms","selectedForm","getFromLocalStorage","selectedFilter","onMounted","firstplugin","firstform","watch","setToLocalStorage","onChangeForm","id","e","form","fm","plugin","formid","ChartJS","Title","Tooltip","Legend","BarElement","CategoryScale","LinearScale","PointElement","LineElement","chartDatas","isLoading","notice","chartData","chartType","noData","chartOption","getAnalyticsData","prepareChatData","data","attributes","row","cData","d","queryParams","axiosPost","error","changeChartType","value","ElNotification","pinia","createPinia","analyticsApp","createApp","Analytics"],"mappings":"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"}