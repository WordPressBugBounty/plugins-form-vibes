import{x as v,L as x,A as F,Q as E,o as i,g as L,k as d,h as t,w as c,W as O,X as V,l as g,E as P,ag as M,n as $,ah as W,O as j,J as U,j as R,s as w,a4 as G,ad as H,ae as I,af as J}from"../assets/post-2433f428.js";import{u as N,g as q,s as A}from"../assets/formvibes-4c4994e4.js";import{_ as Q}from"../assets/header-7033ae65.js";import{b as X,d as K,c as Y}from"../assets/select-b70937af.js";import{_ as Z}from"../assets/date-picker-25a0adc5.js";import{v as aa}from"../assets/loading-128c1aab.js";import{C as ea,p as ta,a as sa,b as la,B as oa,c as na,L as ra,P as ca,d as ia,e as ua,f as va}from"../assets/index-4baa6a2e.js";import{E as da}from"../assets/index-2f3cc352.js";import"../assets/focus-trap-9b255300.js";import"../assets/date-picker-1de719c3.js";import"../assets/index-8e3cc18a.js";const pa={class:"fv-content-wrapper fv-action-bar-wrapper"},fa=d("div",{class:"fv-page-title"},[d("h3",null,"Analytics")],-1),ma={class:"fv-action-bar"},ha={class:"fv-analytics-controls left"},_a={class:"fv-analytics-controls right"},ya=d("span",null,"By Day",-1),ga=d("span",null,"By Week",-1),ba=d("span",null,"By Month",-1),Da={__name:"analtics-control-bar",props:["getAnalyticsData","chartType","changeChartType"],setup(a){const e=N(),s=v("bar"),l=a,{formsSelector:r,generalStates:n,isNoPlugins:o,isPro:u,dates:p}=x(e),f=r.value,y=v(q("fv-form")),m=v(q("fv-analytics-filter")||"month");F((()=>{if(!y.value){const a=f[0]?.label,e=f[0]?.options[0]?.value;y.value=e,n.value.queryParams={...n.value.queryParams,plugin:a,formid:e}}})),E([s],(()=>{l.changeChartType(s),A("fv-chart-type",s)})),E([m],(()=>{A("fv-analytics-filter",m.value),n.value={...n.value,queryParams:{...n.value.queryParams,filter_type:m.value}},l.getAnalyticsData()}));return(e,r)=>{const o=X,u=K,v=Y,p=U;return i(),L("div",pa,[fa,d("div",ma,[d("div",ha,[t(Z),t(v,{modelValue:y.value,"onUpdate:modelValue":r[0]||(r[0]=a=>y.value=a),placeholder:"Select"},{default:c((()=>[(i(!0),L(O,null,V(g(f),(a=>(i(),P(u,{key:a.label,label:a.label},{default:c((()=>[(i(!0),L(O,null,V(a.options,(e=>(i(),P(o,{key:e.value,label:e.label,value:e.value,onClick:s=>((a,e)=>{const s=f.filter((a=>a.label===e.label))[0].options.filter((e=>e.value===a))[0],t=s.plugin,r=s.value;A("fv-form",s),n.value={...n.value,queryParams:{...n.value.queryParams,plugin:t||(f?.length>0?f[0]?.options[0]?.plugin:[]),formid:r||(f?.length>0?f[0]?.options[0]?.value:[])}},l.getAnalyticsData()})(e.value,a)},null,8,["label","value","onClick"])))),128))])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])]),d("div",_a,[t(p,{size:"20",onClick:r[1]||(r[1]=a=>s.value="bar"),class:$([{active:"bar"==s.value},"fv-anyltics-chart"])},{default:c((()=>[t(g(M))])),_:1},8,["class"]),t(p,{size:"20",onClick:r[2]||(r[2]=a=>s.value="line"),class:$([{active:"line"==s.value},"fv-anyltics-chart"])},{default:c((()=>[t(g(W))])),_:1},8,["class"]),t(p,{size:"20",onClick:r[3]||(r[3]=e=>a.getAnalyticsData())},{default:c((()=>[t(g(j))])),_:1}),t(v,{modelValue:m.value,"onUpdate:modelValue":r[4]||(r[4]=a=>m.value=a),placeholder:"Select"},{default:c((()=>[t(o,{label:"By Day",value:"day"},{default:c((()=>[ya])),_:1}),t(o,{label:"By Week",value:"week"},{default:c((()=>[ga])),_:1}),t(o,{label:"By Month",value:"month"},{default:c((()=>[ba])),_:1})])),_:1},8,["modelValue"])])])])}}},Ca={class:"fv-content-wrapper"},ka={class:"fv-chart-wrapper"},La={__name:"chart",props:["chartData","chartOption","chartType","isLoading"],setup(a){ea.register(ta,sa,la,oa,na,ra,ca,ia);const e=a,s=v({labels:[],datasets:[{label:"",data:[]}]});return v({responsive:!0,maintainAspectRatio:!1}),E([()=>e.chartData],(()=>{s.value={labels:e.chartData.labels,datasets:e.chartData.datasets}})),(e,t)=>{const l=aa;return i(),L("div",Ca,[R((i(),L("div",ka,["bar"==a.chartType?(i(),P(g(ua),{key:0,data:s.value,height:"100",options:a.chartOption},null,8,["data","options"])):w("",!0),"line"==a.chartType?(i(),P(g(va),{key:1,data:s.value,height:"100",options:a.chartOption},null,8,["data","options"])):w("",!0)])),[[l,a.isLoading]])])}}},Ea={__name:"analytics",setup(a){const e=N(),{isNoPlugins:s,isLoading:l,generalStates:r,dates:n,notice:o}=x(e),u=v([]),p=v("bar"),f=v([]),y=v({scales:{y:{min:0,ticks:{stepSize:1}}}});F((()=>{m()})),E([()=>r.value.queryParams],(()=>{m()}));const m=async()=>{if(s.value)return;l.value=!0;let{queryParams:a}=r.value;a={...a,fromDate:n.value[0]||"",toDate:n.value[1]||""};try{const{data:s}=await G({queryParams:a,action:"fv_get_analytics_data"});(a=>{const e=[];e.labels=[],e.datasets=[],e.data=[],Object.keys(a).forEach((s=>{e.labels.push(a[s].Label),e.data.push(a[s].count)}));const s={labels:e.labels,datasets:[{label:"Leads",backgroundColor:"#0071a14D",borderColor:"#0071a1",borderWidth:3,hoverBackgroundColor:"#00aadc",data:e.data}]};Object.keys(s).length>0&&(u.value=s),f.value=e.data.every((a=>0===a))})(s),e.resetError()}catch(a){o.value={...o.value,isError:!0,message:a.message}}finally{l.value=!1}},h=a=>{p.value=a._value};return E([o],(()=>{""!==o.value.message&&da({offset:30,dangerouslyUseHTMLString:!0,message:`<strong>${o.value.message}</strong>`,type:o.value.isError?"error":"success",class:"fv-items-center"})})),(a,e)=>{const s=H;return i(),P(s,null,{default:c((()=>[d("div",null,[t(Q),t(Da,{getAnalyticsData:m,chartType:p.value,changeChartType:h},null,8,["chartType"]),t(La,{chartData:u.value,chartOption:y.value,chartType:p.value,isLoading:g(l)},null,8,["chartData","chartOption","chartType","isLoading"])])])),_:1})}}},Pa=I(),z=J(Ea);z.use(Pa),z.mount("#fv-analytics");